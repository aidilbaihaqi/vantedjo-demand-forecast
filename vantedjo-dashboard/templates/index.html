<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard & Metodologi - Kios Vantedjo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='methodology.css') }}">
    <style>
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* Navigation sticky */
        .nav-menu {
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        /* Section spacing */
        .main-section {
            scroll-margin-top: 80px;
        }
        
        /* Divider */
        .section-divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #60a5fa, transparent);
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Menu -->
        <nav class="nav-menu">
            <a href="#dashboard" class="nav-link">ğŸ“Š Dashboard</a>
            <a href="#methodology" class="nav-link">ğŸ“š Metodologi</a>
            <a href="#crisp-dm" class="nav-link">ğŸ”„ CRISP-DM</a>
            <a href="#comparison" class="nav-link">ğŸ“ˆ Perbandingan</a>
        </nav>

        <!-- ============================================ -->
        <!-- SECTION 1: DASHBOARD PREDIKSI -->
        <!-- ============================================ -->
        <section id="dashboard" class="main-section">
            <header>
                <h1>Dashboard Prediksi Jumlah Permintaan Harian Ayam</h1>
                <h2>Kios Vantedjo</h2>
                <div class="period-info">
                    <p>Model: <strong>SARIMAX(1,1,1)(1,1,1,7)</strong></p>
                    <p>Periode Prediksi: <strong id="predictionPeriod">Loading...</strong></p>
                    <p class="note">Prediksi 7 hari ke depan menggunakan model SARIMAX dengan exogenous variables</p>
                </div>
            </header>

            <!-- Statistik Cards -->
            <div class="stats-container" id="statsContainer">
                <div class="stat-card">
                    <h3>Ayam Potong</h3>
                    <div class="stat-value" id="statPotong">-</div>
                    <p class="stat-label">Rata-rata Prediksi (kg/hari)</p>
                </div>
                <div class="stat-card">
                    <h3>Ayam Kampung</h3>
                    <div class="stat-value" id="statKampung">-</div>
                    <p class="stat-label">Rata-rata Prediksi (kg/hari)</p>
                </div>
                <div class="stat-card">
                    <h3>Ayam Tua</h3>
                    <div class="stat-value" id="statTua">-</div>
                    <p class="stat-label">Rata-rata Prediksi (kg/hari)</p>
                </div>
            </div>
            
            <!-- Debug Button (temporary) -->
            <div style="text-align: center; padding: 20px;">
                <button onclick="testUpdate()" style="padding: 10px 20px; background: #60a5fa; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                    ğŸ”„ Test Update Stats
                </button>
            </div>

            <!-- Model Info Card -->
            <div class="model-info-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 15px; margin: 30px 0; color: white;">
                <h3 style="margin-top: 0; font-size: 1.8em;">ğŸ¤– Model SARIMAX</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h4 style="margin-top: 0;">ğŸ“Š Parameter Model</h4>
                        <p><strong>Order:</strong> (1, 1, 1)</p>
                        <p><strong>Seasonal Order:</strong> (1, 1, 1, 7)</p>
                        <p><strong>Seasonal Period:</strong> 7 hari (weekly)</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h4 style="margin-top: 0;">ğŸ¯ Exogenous Variables</h4>
                        <p>â€¢ Calendar features (dow, weekend, event)</p>
                        <p>â€¢ Lag features (lag1, lag3, lag7)</p>
                        <p>â€¢ Moving averages (ma3, ma7)</p>
                    </div>
                    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
                        <h4 style="margin-top: 0;">âœ… Keunggulan</h4>
                        <p>â€¢ Menangkap pola seasonal</p>
                        <p>â€¢ Dynamic forecasting</p>
                        <p>â€¢ Akurasi tinggi (MAPE < 20%)</p>
                    </div>
                </div>
            </div>

            <!-- Chart Prediksi -->
            <div class="chart-container">
                <h3>Grafik Prediksi 7 Hari</h3>
                <canvas id="predictionChart"></canvas>
            </div>

            <!-- Tabel Prediksi -->
            <div class="table-container">
                <h3>Detail Prediksi Harian</h3>
                <table id="predictionTable">
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Ayam Potong</th>
                            <th>Ayam Kampung</th>
                            <th>Ayam Tua</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr>
                            <td colspan="5" class="loading">Memuat data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <div class="section-divider"></div>

        <!-- ============================================ -->
        <!-- SECTION 2: METODOLOGI -->
        <!-- ============================================ -->
        <section id="methodology" class="main-section">
            <div class="methodology-section">
                <h2 style="text-align: center; font-size: 2.5em; color: #ffffff; margin: 40px 0;">
                    ğŸ“š Metodologi Penelitian
                </h2>
                <p style="text-align: center; color: #a0a0a0; font-size: 1.2em; margin-bottom: 40px;">
                    Forecasting Penjualan Ayam menggunakan CRISP-DM
                </p>
            </div>

            <!-- CRISP-DM Flow -->
            <div id="crisp-dm" class="crisp-dm-flow main-section">
                <h3>ğŸ”„ Alur CRISP-DM</h3>
                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Business Understanding</div>
                        <div class="step-desc">Memahami kebutuhan bisnis</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Data Understanding</div>
                        <div class="step-desc">Eksplorasi data awal</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-title">Data Preparation</div>
                        <div class="step-desc">Cleaning & preprocessing</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-title">Modeling</div>
                        <div class="step-desc">Build model ARIMA</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-title">Evaluation</div>
                        <div class="step-desc">Validasi akurasi</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="step-number">6</div>
                        <div class="step-title">Deployment</div>
                        <div class="step-desc">Dashboard web</div>
                    </div>
                </div>
            </div>

            <!-- Phase 1: Business Understanding -->
            <div class="methodology-section">
                <h3>ğŸ“Š Phase 1: Business Understanding</h3>
                <div class="content-box">
                    <h4>Permasalahan Bisnis:</h4>
                    <ul>
                        <li><strong>Overstock:</strong> Ayam busuk karena stok berlebih â†’ Kerugian</li>
                        <li><strong>Understock:</strong> Kehabisan stok â†’ Kehilangan pelanggan</li>
                        <li><strong>Ketidakpastian:</strong> Sulit memprediksi permintaan harian</li>
                    </ul>
                    
                    <h4>Tujuan Proyek:</h4>
                    <ul>
                        <li>Memprediksi permintaan ayam untuk 14 hari ke depan</li>
                        <li>Membantu owner dalam perencanaan stok</li>
                        <li>Mengurangi waste dan meningkatkan profit</li>
                    </ul>

                    <h4>Success Criteria:</h4>
                    <ul>
                        <li>Akurasi prediksi minimal 80% (MAPE < 20%)</li>
                        <li>Dashboard yang mudah digunakan owner</li>
                        <li>Rekomendasi stok yang actionable</li>
                    </ul>
                </div>
            </div>

            <!-- Phase 2: Data Understanding -->
            <div class="methodology-section">
                <h3>ğŸ” Phase 2: Data Understanding</h3>
                <div class="content-box">
                    <h4>Sumber Data:</h4>
                    <div class="data-source">
                        <p><strong>ğŸ“ Lokasi:</strong> Kios Vantedjo, Surabaya</p>
                        <p><strong>ğŸ“… Periode:</strong> Januari - Desember 2024 (366 hari)</p>
                        <p><strong>ğŸ“ Metode Pengumpulan:</strong> Wawancara & Dokumentasi Penjualan</p>
                        <p><strong>ğŸ“Š Format:</strong> Excel (.xlsx)</p>
                    </div>

                    <h4>Karakteristik Data Mentah:</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Total Records</div>
                            <div class="stat-value">366 hari</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Jenis Ayam</div>
                            <div class="stat-value">3 kategori</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Missing Values</div>
                            <div class="stat-value">0 hari</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Hari Tutup</div>
                            <div class="stat-value">16 hari</div>
                        </div>
                    </div>

                    <h4>Alasan Toko Tutup / Tidak Ada Transaksi:</h4>
                    <div class="closed-reasons">
                        <div class="reason-item">
                            <span class="reason-icon">ğŸ¥</span>
                            <span class="reason-text">Sakit (Owner/Karyawan)</span>
                        </div>
                        <div class="reason-item">
                            <span class="reason-icon">ğŸ‰</span>
                            <span class="reason-text">Hari Kemerdekaan / Libur Nasional</span>
                        </div>
                        <div class="reason-item">
                            <span class="reason-icon">ğŸ“¦</span>
                            <span class="reason-text">Antar Stok (Pengiriman)</span>
                        </div>
                        <div class="reason-item">
                            <span class="reason-icon">ğŸŠ</span>
                            <span class="reason-text">Tahun Baru</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Data Preparation -->
            <div class="methodology-section">
                <h3>ğŸ› ï¸ Phase 3: Data Preparation</h3>
                <div class="content-box">
                    <h4>Proses Cleaning Data:</h4>
                    <div class="process-steps">
                        <div class="process-step">
                            <div class="process-number">1</div>
                            <div class="process-content">
                                <h5>Identifikasi Hari Tutup & Wawancara Ulang</h5>
                                <p>Melakukan wawancara ulang dengan owner untuk mengidentifikasi alasan toko tutup pada 10 hari tertentu. Apakah benar-benar tutup atau tidak ada transaksi.</p>
                                <code>df['is_closed'] = False  # Tambah atribut is_closed</code>
                            </div>
                        </div>

                        <div class="process-step">
                            <div class="process-number">2</div>
                            <div class="process-content">
                                <h5>Marking Hari Tutup</h5>
                                <p>Menandai 10 hari yang toko benar-benar tutup dengan atribut is_closed = True</p>
                                <code>df.loc[closed_dates, 'is_closed'] = True</code>
                            </div>
                        </div>

                        <div class="process-step">
                            <div class="process-number">3</div>
                            <div class="process-content">
                                <h5>Handling Data Hari Tutup</h5>
                                <p>Data pada hari tutup diisi dengan 0 karena memang tidak ada penjualan</p>
                                <code>df.loc[df['is_closed'], 'quantity'] = 0</code>
                            </div>
                        </div>

                        <div class="process-step">
                            <div class="process-number">4</div>
                            <div class="process-content">
                                <h5>Outlier Detection & Handling</h5>
                                <p>Identifikasi dan handle outlier menggunakan IQR method untuk data yang valid</p>
                                <code>Q1, Q3 = df[~df['is_closed']].quantile([0.25, 0.75])</code>
                            </div>
                        </div>

                        <div class="process-step">
                            <div class="process-number">5</div>
                            <div class="process-content">
                                <h5>Time Series Preparation</h5>
                                <p>Set date sebagai index dan sort chronologically untuk modeling</p>
                                <code>df.set_index('date').sort_index()</code>
                            </div>
                        </div>
                    </div>

                    <h4>Hasil Data Bersih:</h4>
                    <div class="clean-data-chart">
                        <canvas id="cleanDataChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Phase 4: Modeling -->
            <div class="methodology-section">
                <h3>ğŸ¤– Phase 4: Modeling</h3>
                <div class="content-box">
                    <h4>Model yang Digunakan: SARIMAX</h4>
                    <div class="model-info">
                        <p><strong>SARIMAX</strong> = Seasonal AutoRegressive Integrated Moving Average with eXogenous variables</p>
                        <p>Model time series yang menangkap pola trend, seasonality, dan menggunakan variabel eksternal</p>
                    </div>

                    <h4>Parameter Model:</h4>
                    <div class="model-params">
                        <div class="param-item">
                            <div class="param-name">p (AR order)</div>
                            <div class="param-value">1</div>
                            <div class="param-desc">Autoregressive order 1</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">d (Differencing)</div>
                            <div class="param-value">1</div>
                            <div class="param-desc">Differencing order 1</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">q (MA order)</div>
                            <div class="param-value">1</div>
                            <div class="param-desc">Moving average order 1</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">P (Seasonal AR)</div>
                            <div class="param-value">1</div>
                            <div class="param-desc">Seasonal AR order 1</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">D (Seasonal Diff)</div>
                            <div class="param-value">1</div>
                            <div class="param-desc">Seasonal differencing 1</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">Q (Seasonal MA)</div>
                            <div class="param-value">1</div>
                            <div class="param-desc">Seasonal MA order 1</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">s (Seasonal Period)</div>
                            <div class="param-value">7</div>
                            <div class="param-desc">Weekly seasonality (7 hari)</div>
                        </div>
                    </div>

                    <h4>Exogenous Variables:</h4>
                    <div class="model-params">
                        <div class="param-item">
                            <div class="param-name">Calendar Features</div>
                            <div class="param-desc">is_closed, dow, is_weekend, is_event, pre_event_peak, restock_flag</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">Lag Features</div>
                            <div class="param-desc">lag1, lag3, lag7 (penjualan hari sebelumnya)</div>
                        </div>
                        <div class="param-item">
                            <div class="param-name">Moving Averages</div>
                            <div class="param-desc">ma3, ma7 (rata-rata bergerak)</div>
                        </div>
                    </div>

                    <h4>Proses Training:</h4>
                    <pre><code>from statsmodels.tsa.statespace.sarimax import SARIMAX

# Build model SARIMAX untuk setiap jenis ayam
model = SARIMAX(
    endog=y_train,
    exog=X_train,
    order=(1, 1, 1),
    seasonal_order=(1, 1, 1, 7),
    enforce_stationarity=False,
    enforce_invertibility=False
)

# Fit model
res = model.fit(disp=False, maxiter=300)

# Dynamic forecast 7 hari dengan exogenous variables
forecast = res.forecast(steps=7, exog=X_future)</code></pre>
                </div>
            </div>

            <!-- Phase 5: Evaluation -->
            <div class="methodology-section">
                <h3>âœ… Phase 5: Evaluation</h3>
                <div class="content-box">
                    <h4>Metrik Evaluasi (7 hari terakhir):</h4>
                    <div class="evaluation-metrics">
                        <div class="metric-card">
                            <h5>Ayam Potong</h5>
                            <div class="metric-value good">MAPE: 4.83%</div>
                            <div class="metric-label">Akurasi Sangat Baik</div>
                            <div class="metric-detail">MAE: 1.362 kg | RMSE: 1.831 kg</div>
                        </div>
                        <div class="metric-card">
                            <h5>Ayam Kampung</h5>
                            <div class="metric-value good">MAPE: 4.09%</div>
                            <div class="metric-label">Akurasi Sangat Baik</div>
                            <div class="metric-detail">MAE: 0.489 kg | RMSE: 0.858 kg</div>
                        </div>
                        <div class="metric-card">
                            <h5>Ayam Tua</h5>
                            <div class="metric-value good">MAPE: 7.75%</div>
                            <div class="metric-label">Akurasi Baik</div>
                            <div class="metric-detail">MAE: 0.251 kg | RMSE: 0.256 kg</div>
                        </div>
                    </div>

                    <h4>Interpretasi Hasil:</h4>
                    <ul>
                        <li>âœ… Semua model SARIMAX mencapai akurasi sangat baik (MAPE < 20%)</li>
                        <li>âœ… Model menangkap pola seasonal (weekly pattern) dengan baik</li>
                        <li>âœ… Exogenous variables meningkatkan akurasi prediksi</li>
                        <li>âœ… Dynamic forecasting dengan lag features memberikan hasil lebih akurat</li>
                        <li>âœ… Model layak untuk deployment dan dapat menyelesaikan permasalahan owner</li>
                    </ul>
                    
                    <h4>Keunggulan SARIMAX vs ARIMA:</h4>
                    <ul>
                        <li>ğŸ¯ Menangkap pola seasonal (weekly pattern) secara eksplisit</li>
                        <li>ğŸ“Š Menggunakan exogenous variables (kalender, event, lag, MA)</li>
                        <li>ğŸ”„ Dynamic forecasting yang lebih adaptif</li>
                        <li>âœ¨ Akurasi lebih tinggi untuk data dengan seasonality</li>
                        <li>ğŸ’¡ Dapat memprediksi dampak event/libur terhadap permintaan</li>
                    </ul>
                </div>
            </div>

            <!-- Phase 6: Deployment -->
            <div class="methodology-section">
                <h3>ğŸš€ Phase 6: Deployment</h3>
                <div class="content-box">
                    <h4>Implementasi:</h4>
                    <div class="deployment-info">
                        <div class="deploy-item">
                            <h5>Backend</h5>
                            <p>Flask (Python) untuk API dan model serving</p>
                        </div>
                        <div class="deploy-item">
                            <h5>Frontend</h5>
                            <p>HTML/CSS/JavaScript untuk dashboard interaktif</p>
                        </div>
                        <div class="deploy-item">
                            <h5>Model</h5>
                            <p>SARIMAX(1,1,1)(1,1,1,7) dengan statsmodels</p>
                        </div>
                        <div class="deploy-item">
                            <h5>Update</h5>
                            <p>Model dapat di-retrain dengan data baru</p>
                        </div>
                    </div>

                    <h4>Fitur Dashboard:</h4>
                    <ul>
                        <li>ğŸ“Š Visualisasi prediksi 7 hari menggunakan SARIMAX</li>
                        <li>ğŸ“ˆ Grafik interaktif dengan Chart.js</li>
                        <li>ğŸ“‹ Tabel detail prediksi harian</li>
                        <li>ğŸ¤– Informasi model dan parameter SARIMAX</li>
                        <li>ğŸ’¡ Rekomendasi stok untuk owner</li>
                        <li>ğŸ¨ Dark theme untuk kenyamanan mata</li>
                    </ul>
                </div>
            </div>

            <!-- Comparison Chart -->
            <div id="comparison" class="methodology-section main-section">
                <h3>ğŸ“Š Perbandingan: Data Bersih vs Prediksi</h3>
                <div class="content-box">
                    <div class="comparison-chart">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <p class="chart-note">
                        Grafik menunjukkan 30 hari terakhir data historis (bersih) dan 14 hari prediksi ke depan
                    </p>
                </div>
            </div>
        </section>

        <footer>
            <p>Â© 2025 Kios Vantedjo - Data Mining Project</p>
            <p class="footer-note">Metodologi: CRISP-DM | Model: SARIMAX(1,1,1)(1,1,1,7) | Forecast: 7 hari | Akurasi: AP (4.83%), AK (4.09%), AT (7.75%)</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='methodology.js') }}"></script>
    <script>
        // Smooth scroll untuk navigation
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth' });
                    
                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Update active nav on scroll
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.main-section');
            const navLinks = document.querySelectorAll('.nav-link');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= (sectionTop - 100)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
